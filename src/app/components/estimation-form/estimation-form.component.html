<!-- Version compacte -->
<div *ngIf="compact" class="glass-card rounded-2xl flex flex-col">
  <div class="p-4 lg:p-6 pb-8 lg:pb-14 flex flex-col">
    <!-- En-tête avec titre et onglets -->
    <div class="mb-4 lg:mb-6 pb-3 lg:pb-4 border-b glass-divider shrink-0">
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-lg lg:text-xl font-bold text-glass-primary">Paramètres</h2>
      </div>
      
      <!-- Système d'onglets -->
      <div class="inline-flex rounded-lg w-full">
        <button
          (click)="setActiveTab('base')"
          class="flex-1 flex items-center justify-center gap-2 px-4 py-2 text-xs lg:text-sm font-medium rounded-lg transition-all duration-200"
          [ngClass]="{
            'tab-active text-glass-primary': activeTab === 'base',
            'text-glass-secondary hover:text-glass-primary hover:bg-white/5': activeTab !== 'base'
          }"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <span class="hidden sm:inline">Informations</span>
        </button>
        <button
          (click)="setActiveTab('curseurs')"
          class="flex-1 flex items-center justify-center gap-2 px-4 py-2 text-xs lg:text-sm font-medium rounded-lg transition-all duration-200"
          [ngClass]="{
            'tab-active text-glass-primary': activeTab === 'curseurs',
            'text-glass-secondary hover:text-glass-primary hover:bg-white/5': activeTab !== 'curseurs'
          }"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
          </svg>
          <span class="hidden sm:inline">Évaluation</span>
        </button>
      </div>
    </div>

    <div class="space-y-4 lg:space-y-6">
    
    <!-- Onglet 1 : Paramètres de base -->
    <div *ngIf="activeTab === 'base'" class="space-y-4">
      <!-- Titre -->
      <div>
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-secondary">
            Titre <span class="text-red-500">(*)</span>
          </label>
          <span class="text-xs" [ngClass]="formData.name.length > charLimits.name ? 'text-red-400' : 'text-glass-muted'">
            {{ formData.name.length }}/{{ charLimits.name }}
          </span>
        </div>
        <input
          type="text"
          [(ngModel)]="formData.name"
          (ngModelChange)="onFieldChange()"
          [maxlength]="charLimits.name"
          placeholder="Ex: Authentification utilisateur"
          class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm"
        />
      </div>

      <!-- Description (juste sous le titre) -->
      <div>
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-secondary">
            Description
          </label>
          <span class="text-xs" [ngClass]="formData.description.length > charLimits.description ? 'text-red-400' : 'text-glass-muted'">
            {{ formData.description.length }}/{{ charLimits.description }}
          </span>
        </div>
        <textarea
          [(ngModel)]="formData.description"
          (ngModelChange)="onFieldChange()"
          [maxlength]="charLimits.description"
          rows="3"
          placeholder="Description détaillée de la tâche..."
          class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm resize-none"
        ></textarea>
      </div>

      <!-- Date et Auteur sur la même ligne -->
      <div class="grid grid-cols-2 gap-3">
        <!-- Date -->
        <div>
          <label class="block text-sm font-semibold text-glass-secondary mb-2">
            Date
          </label>
          <input
            type="date"
            [(ngModel)]="formData.date"
            (ngModelChange)="onFieldChange()"
            class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm"
          />
        </div>

        <!-- Auteur -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-semibold text-glass-secondary">
              Auteur
            </label>
            <span class="text-xs" [ngClass]="formData.author.length > charLimits.author ? 'text-red-400' : 'text-glass-muted'">
              {{ formData.author.length }}/{{ charLimits.author }}
            </span>
          </div>
          <input
            type="text"
            [(ngModel)]="formData.author"
            (ngModelChange)="onFieldChange()"
            [maxlength]="charLimits.author"
            placeholder="Votre nom"
            class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm"
          />
        </div>
      </div>

      <!-- Bouton Supprimer -->
      <div class="pt-4 border-t glass-divider">
        <button
          (click)="onDelete()"
          class="w-full px-4 py-2 text-red-500 hover:text-red-400 text-sm rounded-lg transition-colors flex items-center justify-center gap-2"
          title="Supprimer cette estimation"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Supprimer cette estimation
        </button>
      </div>
    </div>

    <!-- Onglet 2 : CURSE Sliders compacts -->
    <div *ngIf="activeTab === 'curseurs'" class="space-y-4 lg:space-y-6">
      <!-- Complexity -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-yellow-500 text-base">C</span> - Complexité
          </label>
          <p class="text-xs text-glass-muted mt-0.5 hidden sm:block">Difficulté technique ou fonctionnelle</p>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-yellow" [style.width.%]="formData.complexity"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('complexity')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.complexity"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-yellow"
          />
        </div>
      </div>

      <!-- Uncertainty -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-purple-500 text-base">U</span> - Incertitude
          </label>
          <p class="text-xs text-glass-muted mt-0.5 hidden sm:block">Zones floues, manque d'informations</p>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-purple" [style.width.%]="formData.uncertainty"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('uncertainty')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.uncertainty"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-purple"
          />
        </div>
      </div>

      <!-- Risk -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-red-500 text-base">R</span> - Risque
          </label>
          <p class="text-xs text-glass-muted mt-0.5 hidden sm:block">Dépendances, impacts, dangers potentiels</p>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-red" [style.width.%]="formData.risk"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('risk')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.risk"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-red"
          />
        </div>
      </div>

      <!-- Size -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-green-500 text-base">S</span> - Taille
          </label>
          <p class="text-xs text-glass-muted mt-0.5 hidden sm:block">Ampleur globale du travail</p>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-green" [style.width.%]="formData.size"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('size')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.size"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-green"
          />
        </div>
      </div>

      <!-- Effort -->
      <div class="px-2 lg:px-4">
        <div class="mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-blue-500 text-base">E</span> - Effort
          </label>
          <p class="text-xs text-glass-muted mt-0.5 hidden sm:block">Charge de travail estimée</p>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-blue" [style.width.%]="formData.effort"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('effort')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.effort"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-blue"
          />
        </div>
      </div>

    </div>
    <!-- Fin onglet curseurs -->
    </div>
  </div>
</div>

<!-- Version complète (pour édition détaillée si nécessaire) -->
<div *ngIf="!compact" class="glass-card rounded-2xl p-6">
  <div class="flex justify-between items-center mb-6 pb-4 border-b glass-divider">
    <h2 class="text-2xl font-bold text-glass-primary">⚙️ Paramètres</h2>
  </div>

  <div class="space-y-6">
    <!-- Nom -->
    <div>
      <div class="flex justify-between items-center mb-2">
        <label class="text-sm font-semibold text-glass-secondary">
          Nom de la tâche / User Story <span class="text-red-500">(*)</span>
        </label>
        <span class="text-xs" [ngClass]="formData.name.length > charLimits.name ? 'text-red-400' : 'text-glass-muted'">
          {{ formData.name.length }}/{{ charLimits.name }}
        </span>
      </div>
      <input
        type="text"
        [(ngModel)]="formData.name"
        (ngModelChange)="onFieldChange()"
        [maxlength]="charLimits.name"
        placeholder="Ex: Authentification utilisateur"
        class="glass-input w-full px-4 py-2.5 rounded-lg"
      />
    </div>

    <!-- Description -->
    <div>
      <div class="flex justify-between items-center mb-2">
        <label class="text-sm font-semibold text-glass-secondary">
          Description (optionnel)
        </label>
        <span class="text-xs" [ngClass]="formData.description.length > charLimits.description ? 'text-red-400' : 'text-glass-muted'">
          {{ formData.description.length }}/{{ charLimits.description }}
        </span>
      </div>
      <textarea
        [(ngModel)]="formData.description"
        (ngModelChange)="onFieldChange()"
        [maxlength]="charLimits.description"
        rows="3"
        placeholder="Description détaillée de la tâche..."
        class="glass-input w-full px-4 py-2.5 rounded-lg"
      ></textarea>
    </div>

    <!-- CURSE Sliders -->
    <div class="space-y-6">
      <!-- Complexity -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-yellow-500 text-base">C</span> - Complexity (Complexité)
          </label>
          <span class="text-sm font-bold text-yellow-500 bg-yellow-500/20 px-3 py-1 rounded-lg">
            {{ getGraduationForValue(formData.complexity, 'complexity')?.label || '' }}
          </span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-yellow" [style.width.%]="formData.complexity"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('complexity')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.complexity"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-yellow"
          />
        </div>
        <p class="text-xs text-glass-muted mt-2">Difficulté technique ou fonctionnelle</p>
      </div>

      <!-- Uncertainty -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-purple-500 text-base">U</span> - Uncertainty (Incertitude)
          </label>
          <span class="text-sm font-bold text-purple-500 bg-purple-500/20 px-3 py-1 rounded-lg">
            {{ getGraduationForValue(formData.uncertainty, 'uncertainty')?.label || '' }}
          </span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-purple" [style.width.%]="formData.uncertainty"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('uncertainty')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.uncertainty"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-purple"
          />
        </div>
        <p class="text-xs text-glass-muted mt-2">Zones floues, manque d'informations</p>
      </div>

      <!-- Risk -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-red-500 text-base">R</span> - Risk (Risque)
          </label>
          <span class="text-sm font-bold text-red-500 bg-red-500/20 px-3 py-1 rounded-lg">
            {{ getGraduationForValue(formData.risk, 'risk')?.label || '' }}
          </span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-red" [style.width.%]="formData.risk"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('risk')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.risk"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-red"
          />
        </div>
        <p class="text-xs text-glass-muted mt-2">Dépendances, impacts, dangers potentiels</p>
      </div>

      <!-- Size -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-green-500 text-base">S</span> - Size (Taille / Scope)
          </label>
          <span class="text-sm font-bold text-green-500 bg-green-500/20 px-3 py-1 rounded-lg">
            {{ getGraduationForValue(formData.size, 'size')?.label || '' }}
          </span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-green" [style.width.%]="formData.size"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('size')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.size"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-green"
          />
        </div>
        <p class="text-xs text-glass-muted mt-2">Ampleur globale du travail</p>
      </div>

      <!-- Effort -->
      <div class="glass-inner rounded-lg px-4 py-3 pb-8">
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-primary">
            <span class="font-bold text-orange-500 text-base">E</span> - Effort (Effort)
          </label>
          <span class="text-sm font-bold text-orange-500 bg-orange-500/20 px-3 py-1 rounded-lg">
            {{ getGraduationForValue(formData.effort, 'effort')?.label || '' }}
          </span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-orange" [style.width.%]="formData.effort"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('effort')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.effort"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-orange"
          />
        </div>
        <p class="text-xs text-glass-muted mt-2">Charge de travail estimée</p>
      </div>

    </div>

    <!-- Bouton Supprimer -->
    <div class="pt-6 border-t glass-divider">
      <button
        (click)="onDelete()"
        class="w-full px-4 py-2.5 text-red-400 hover:text-red-300 text-sm rounded-lg transition-colors flex items-center justify-center gap-2"
        title="Supprimer cette estimation"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Supprimer cette estimation
      </button>
    </div>
  </div>
</div>
