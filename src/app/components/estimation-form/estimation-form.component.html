<!-- Version compacte -->
<div *ngIf="compact" class="glass-card rounded-2xl flex flex-col overflow-hidden">
  <div class="p-4 lg:p-6 flex flex-col flex-1 overflow-hidden">
    <!-- En-t√™te avec titre et onglets -->
    <div class="mb-4 lg:mb-6 pb-3 lg:pb-4 border-b glass-divider shrink-0">
      <div class="flex justify-between items-center mb-3">
        <div class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-glass-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <h2 class="text-lg lg:text-xl font-bold text-glass-primary">D√©tails</h2>
        </div>
        <button 
          (click)="closeForm.emit()"
          class="p-1.5 rounded-lg text-red-500 hover:text-red-600 hover:bg-red-500/10 transition-all"
          title="Fermer le mode √©dition"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <!-- Syst√®me d'onglets -->
      <div class="inline-flex rounded-lg w-full">
        <button
          (click)="setActiveTab('base')"
          class="flex-1 flex items-center justify-center gap-2 px-4 py-2 text-xs lg:text-sm font-medium rounded-lg transition-all duration-200"
          [ngClass]="{
            'tab-active text-glass-primary': activeTab === 'base',
            'text-glass-secondary hover:text-glass-primary hover:bg-white/5': activeTab !== 'base'
          }"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <span class="hidden sm:inline">Informations</span>
        </button>
        <button
          (click)="setActiveTab('curseurs')"
          class="flex-1 flex items-center justify-center gap-2 px-4 py-2 text-xs lg:text-sm font-medium rounded-lg transition-all duration-200"
          [ngClass]="{
            'tab-active text-glass-primary': activeTab === 'curseurs',
            'text-glass-secondary hover:text-glass-primary hover:bg-white/5': activeTab !== 'curseurs'
          }"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
          </svg>
          <span class="hidden sm:inline">√âvaluation</span>
        </button>
        <button
          (click)="setActiveTab('conseils')"
          class="flex-1 flex items-center justify-center gap-2 px-4 py-2 text-xs lg:text-sm font-medium rounded-lg transition-all duration-200"
          [ngClass]="{
            'tab-active text-glass-primary': activeTab === 'conseils',
            'text-glass-secondary hover:text-glass-primary hover:bg-white/5': activeTab !== 'conseils'
          }"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
          <span class="hidden sm:inline">Conseils</span>
        </button>
      </div>
    </div>

    <div class="space-y-4 lg:space-y-6 overflow-y-auto flex-1">
    
    <!-- Onglet 1 : Param√®tres de base -->
    <div *ngIf="activeTab === 'base'" class="space-y-4">
      <!-- Titre -->
      <div>
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-secondary">
            Titre <span class="text-red-500">(*)</span>
          </label>
          <span class="text-xs" [ngClass]="formData.name.length > charLimits.name ? 'text-red-400' : 'text-glass-muted'">
            {{ formData.name.length }}/{{ charLimits.name }}
          </span>
        </div>
        <input
          type="text"
          [(ngModel)]="formData.name"
          (ngModelChange)="onFieldChange()"
          [maxlength]="charLimits.name"
          placeholder="Ex: Authentification utilisateur"
          class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm"
        />
      </div>

      <!-- Description (juste sous le titre) -->
      <div>
        <div class="flex justify-between items-center mb-2">
          <label class="text-sm font-semibold text-glass-secondary">
            Description
          </label>
          <span class="text-xs" [ngClass]="formData.description.length > charLimits.description ? 'text-red-400' : 'text-glass-muted'">
            {{ formData.description.length }}/{{ charLimits.description }}
          </span>
        </div>
        <textarea
          [(ngModel)]="formData.description"
          (ngModelChange)="onFieldChange()"
          [maxlength]="charLimits.description"
          rows="4"
          placeholder="Description d√©taill√©e de la t√¢che..."
          class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm resize-none"
        ></textarea>
      </div>

      <!-- Type -->
      <div>
        <label class="block text-sm font-semibold text-glass-secondary mb-2">
          Type
        </label>
        <select
          [(ngModel)]="formData.type"
          (ngModelChange)="onFieldChange()"
          class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm"
        >
          <option value="user-story">üß© User Story</option>
          <option value="feature">üß± Feature</option>
        </select>
      </div>

      <!-- Date et Auteur sur la m√™me ligne -->
      <div class="grid grid-cols-2 gap-3">
        <!-- Date -->
        <div>
          <label class="block text-sm font-semibold text-glass-secondary mb-2">
            Date
          </label>
          <input
            type="date"
            [(ngModel)]="formData.date"
            (ngModelChange)="onFieldChange()"
            class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm"
          />
        </div>

        <!-- Auteur -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-semibold text-glass-secondary">
              Auteur
            </label>
            <span class="text-xs" [ngClass]="formData.author.length > charLimits.author ? 'text-red-400' : 'text-glass-muted'">
              {{ formData.author.length }}/{{ charLimits.author }}
            </span>
          </div>
          <input
            type="text"
            [(ngModel)]="formData.author"
            (ngModelChange)="onFieldChange()"
            [maxlength]="charLimits.author"
            placeholder="Votre nom"
            class="glass-input w-full px-3 lg:px-4 py-2 lg:py-2.5 rounded-lg text-sm"
          />
        </div>
      </div>

      <!-- Section JSON (mode avanc√©) -->
      <div class="pt-4 border-t glass-divider">
        <!-- Toggle pour afficher/cacher l'√©diteur JSON -->
        <button
          (click)="toggleJsonEditor()"
          class="w-full flex items-center justify-between px-3 py-2 text-xs text-glass-muted hover:text-glass-secondary rounded-lg hover:bg-white/5 transition-all"
        >
          <span class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
            </svg>
            JSON
          </span>
          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            class="w-4 h-4 transition-transform duration-200"
            [class.rotate-180]="showJsonEditor"
            fill="none" 
            viewBox="0 0 24 24" 
            stroke="currentColor" 
            stroke-width="2"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <!-- √âditeur JSON (cach√© par d√©faut) -->
        <div *ngIf="showJsonEditor" class="mt-3 space-y-2">
          <!-- Boutons Copier / Coller -->
          <div class="flex justify-end gap-2">
            <button
              (click)="pasteJson()"
              class="flex items-center gap-1 px-2 py-1 text-[10px] text-glass-muted hover:text-glass-secondary rounded hover:bg-white/5 transition-all"
              title="Coller depuis le presse-papier"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
              </svg>
              Coller
            </button>
            <button
              (click)="copyJson()"
              class="flex items-center gap-1 px-2 py-1 text-[10px] text-glass-muted hover:text-glass-secondary rounded hover:bg-white/5 transition-all"
              title="Copier dans le presse-papier"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Copier
            </button>
          </div>
          <textarea
            [(ngModel)]="jsonEditorContent"
            (ngModelChange)="onJsonChange()"
            rows="12"
            spellcheck="false"
            class="glass-input w-full px-3 py-2 rounded-lg text-xs font-mono resize-none"
            [class.border-red-500]="jsonError"
            placeholder="JSON de l'estimation..."
          ></textarea>
          <p *ngIf="jsonError" class="text-xs text-red-400">{{ jsonError }}</p>
          <p class="text-[10px] text-glass-muted">
            Modifiez directement le JSON pour mettre √† jour l'estimation.
          </p>
        </div>
      </div>

      <!-- Bouton Supprimer -->
      <div class="pt-4 border-t glass-divider">
        <button
          (click)="onDelete()"
          class="w-full px-4 py-2 text-red-500 hover:text-red-400 text-sm rounded-lg transition-colors flex items-center justify-center gap-2"
          title="Supprimer cette estimation"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Supprimer cette estimation
        </button>
      </div>
    </div>

    <!-- Onglet 2 : CURSE Sliders compacts -->
    <div *ngIf="activeTab === 'curseurs'" class="space-y-4 lg:space-y-6 pb-8">
      <!-- Complexity -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="flex items-start justify-between mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Complexit√©</span>
            <span class="text-[10px] text-glass-muted">Difficult√© technique ou fonctionnelle</span>
          </div>
          <span class="text-sm font-bold text-yellow-500 shrink-0">{{ getGraduationForValue(formData.complexity, 'complexity')?.label }}</span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-yellow" [style.width.%]="formData.complexity"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('complexity')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.complexity"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-yellow"
          />
        </div>
      </div>

      <!-- Uncertainty -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="flex items-start justify-between mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Incertitude</span>
            <span class="text-[10px] text-glass-muted">Zones floues, manque d'informations</span>
          </div>
          <span class="text-sm font-bold text-purple-500 shrink-0">{{ getGraduationForValue(formData.uncertainty, 'uncertainty')?.label }}</span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-purple" [style.width.%]="formData.uncertainty"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('uncertainty')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.uncertainty"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-purple"
          />
        </div>
      </div>

      <!-- Risk -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="flex items-start justify-between mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Risque</span>
            <span class="text-[10px] text-glass-muted">D√©pendances, impacts, dangers potentiels</span>
          </div>
          <span class="text-sm font-bold text-red-500 shrink-0">{{ getGraduationForValue(formData.risk, 'risk')?.label }}</span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-red" [style.width.%]="formData.risk"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('risk')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.risk"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-red"
          />
        </div>
      </div>

      <!-- Size -->
      <div class="px-2 lg:px-4 pb-3 lg:pb-4">
        <div class="flex items-start justify-between mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Taille</span>
            <span class="text-[10px] text-glass-muted">Volume de travail √† r√©aliser</span>
          </div>
          <span class="text-sm font-bold text-green-500 shrink-0">{{ getGraduationForValue(formData.size, 'size')?.label }}</span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-green" [style.width.%]="formData.size"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('size')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.size"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-green"
          />
        </div>
      </div>

      <!-- Effort -->
      <div class="px-2 lg:px-4">
        <div class="flex items-start justify-between mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Effort</span>
            <span class="text-[10px] text-glass-muted">Degr√© de p√©nibilit√©</span>
          </div>
          <span class="text-sm font-bold text-blue-500 shrink-0">{{ getGraduationForValue(formData.effort, 'effort')?.label }}</span>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-blue" [style.width.%]="formData.effort"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('effort')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.effort"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-blue"
          />
        </div>
      </div>

    </div>
    <!-- Fin onglet curseurs -->

    <!-- Onglet 3 : Conseils -->
    <div *ngIf="activeTab === 'conseils'" class="space-y-3">
      <ng-container *ngFor="let rec of recommendations">
        <div 
          class="flex items-start gap-3 p-3 rounded-lg transition-all"
          [ngClass]="{
            'bg-green-500/10 border border-green-500/20': rec.type === 'success',
            'bg-amber-500/10 border border-amber-500/20': rec.type === 'warning',
            'bg-red-500/10 border border-red-500/20': rec.type === 'danger',
            'bg-blue-500/10 border border-blue-500/20': rec.type === 'info'
          }"
        >
          <span class="text-lg shrink-0">{{ rec.icon }}</span>
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <span 
                class="text-sm font-semibold"
                [ngClass]="{
                  'text-green-400': rec.type === 'success',
                  'text-amber-400': rec.type === 'warning',
                  'text-red-400': rec.type === 'danger',
                  'text-blue-400': rec.type === 'info'
                }"
              >
                {{ rec.title }}
              </span>
            </div>
            <p class="text-xs text-glass-secondary leading-relaxed">{{ rec.text }}</p>
          </div>
        </div>
      </ng-container>
      
      <!-- Message si aucun conseil -->
      <div *ngIf="!recommendations || recommendations.length === 0" class="text-center py-8 text-glass-muted">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
        <p class="text-sm">Aucun conseil pour cette estimation</p>
      </div>
    </div>
    <!-- Fin onglet conseils -->
    </div>
  </div>
</div>

<!-- Version compl√®te (pour √©dition d√©taill√©e si n√©cessaire) -->
<div *ngIf="!compact" class="glass-card rounded-2xl p-6">
  <div class="flex justify-between items-center mb-6 pb-4 border-b glass-divider">
    <h2 class="text-2xl font-bold text-glass-primary">‚öôÔ∏è Param√®tres</h2>
  </div>

  <div class="space-y-6">
    <!-- Nom -->
    <div>
      <div class="flex justify-between items-center mb-2">
        <label class="text-sm font-semibold text-glass-secondary">
          Nom de la t√¢che / User Story <span class="text-red-500">(*)</span>
        </label>
        <span class="text-xs" [ngClass]="formData.name.length > charLimits.name ? 'text-red-400' : 'text-glass-muted'">
          {{ formData.name.length }}/{{ charLimits.name }}
        </span>
      </div>
      <input
        type="text"
        [(ngModel)]="formData.name"
        (ngModelChange)="onFieldChange()"
        [maxlength]="charLimits.name"
        placeholder="Ex: Authentification utilisateur"
        class="glass-input w-full px-4 py-2.5 rounded-lg"
      />
    </div>

    <!-- Description -->
    <div>
      <div class="flex justify-between items-center mb-2">
        <label class="text-sm font-semibold text-glass-secondary">
          Description (optionnel)
        </label>
        <span class="text-xs" [ngClass]="formData.description.length > charLimits.description ? 'text-red-400' : 'text-glass-muted'">
          {{ formData.description.length }}/{{ charLimits.description }}
        </span>
      </div>
      <textarea
        [(ngModel)]="formData.description"
        (ngModelChange)="onFieldChange()"
        [maxlength]="charLimits.description"
        rows="3"
        placeholder="Description d√©taill√©e de la t√¢che..."
        class="glass-input w-full px-4 py-2.5 rounded-lg"
      ></textarea>
    </div>

    <!-- Type -->
    <div>
      <label class="block text-sm font-semibold text-glass-secondary mb-2">
        Type
      </label>
      <select
        [(ngModel)]="formData.type"
        (ngModelChange)="onFieldChange()"
        class="glass-input w-full px-4 py-2.5 rounded-lg"
      >
        <option value="user-story">üß© User Story</option>
        <option value="feature">üß± Feature</option>
      </select>
    </div>

    <!-- CURSE Sliders -->
    <div class="space-y-6">
      <!-- Complexity -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Complexit√©</span>
            <span class="text-[10px] text-glass-muted">Difficult√© technique ou fonctionnelle</span>
            <span class="text-base font-bold text-yellow-500">{{ getGraduationForValue(formData.complexity, 'complexity')?.label }}</span>
          </div>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-yellow" [style.width.%]="formData.complexity"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('complexity')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.complexity"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-yellow"
          />
        </div>
      </div>

      <!-- Uncertainty -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Incertitude</span>
            <span class="text-[10px] text-glass-muted">Zones floues, manque d'informations</span>
            <span class="text-base font-bold text-purple-500">{{ getGraduationForValue(formData.uncertainty, 'uncertainty')?.label }}</span>
          </div>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-purple" [style.width.%]="formData.uncertainty"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('uncertainty')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.uncertainty"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-purple"
          />
        </div>
      </div>

      <!-- Risk -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Risque</span>
            <span class="text-[10px] text-glass-muted">D√©pendances, impacts, dangers potentiels</span>
            <span class="text-base font-bold text-red-500">{{ getGraduationForValue(formData.risk, 'risk')?.label }}</span>
          </div>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-red" [style.width.%]="formData.risk"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('risk')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.risk"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-red"
          />
        </div>
      </div>

      <!-- Size -->
      <div class="glass-inner rounded-lg px-4 py-3">
        <div class="mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Taille</span>
            <span class="text-[10px] text-glass-muted">Volume de travail √† r√©aliser</span>
            <span class="text-base font-bold text-green-500">{{ getGraduationForValue(formData.size, 'size')?.label }}</span>
          </div>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-green" [style.width.%]="formData.size"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('size')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.size"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-green"
          />
        </div>
      </div>

      <!-- Effort -->
      <div class="glass-inner rounded-lg px-4 py-3 pb-8">
        <div class="mb-2">
          <div class="flex flex-col">
            <span class="text-sm font-semibold text-glass-secondary">Effort</span>
            <span class="text-[10px] text-glass-muted">Degr√© de p√©nibilit√©</span>
            <span class="text-base font-bold text-orange-500">{{ getGraduationForValue(formData.effort, 'effort')?.label }}</span>
          </div>
        </div>
        <div class="slider-container">
          <!-- Track de fond -->
          <div class="slider-track">
            <div class="slider-fill fill-orange" [style.width.%]="formData.effort"></div>
          </div>
          <!-- Graduations -->
          <div class="slider-graduations">
            <div *ngFor="let grad of getGraduations('effort')" 
                 class="graduation-mark"
                 [style.left.%]="grad.value">
              <span class="graduation-label">{{ grad.label }}</span>
            </div>
          </div>
          <!-- Input range -->
          <input
            type="range"
            [(ngModel)]="formData.effort"
            (ngModelChange)="onFieldChange()"
            [min]="0"
            [max]="100"
            [step]="0.1"
            class="slider-orange"
          />
        </div>
      </div>

    </div>

    <!-- Section JSON (mode avanc√©) -->
    <div class="pt-6 border-t glass-divider">
      <!-- Toggle pour afficher/cacher l'√©diteur JSON -->
      <button
        (click)="toggleJsonEditor()"
        class="w-full flex items-center justify-between px-3 py-2 text-xs text-glass-muted hover:text-glass-secondary rounded-lg hover:bg-white/5 transition-all"
      >
        <span class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
          Mode JSON avanc√©
        </span>
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          class="w-4 h-4 transition-transform duration-200"
          [class.rotate-180]="showJsonEditor"
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor" 
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <!-- √âditeur JSON (cach√© par d√©faut) -->
      <div *ngIf="showJsonEditor" class="mt-3 space-y-2">
        <!-- Boutons Copier / Coller -->
        <div class="flex justify-end gap-2">
          <button
            (click)="pasteJson()"
            class="flex items-center gap-1 px-2 py-1 text-xs text-glass-muted hover:text-glass-secondary rounded hover:bg-white/5 transition-all"
            title="Coller depuis le presse-papier"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            Coller
          </button>
          <button
            (click)="copyJson()"
            class="flex items-center gap-1 px-2 py-1 text-xs text-glass-muted hover:text-glass-secondary rounded hover:bg-white/5 transition-all"
            title="Copier dans le presse-papier"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            Copier
          </button>
        </div>
        <textarea
          [(ngModel)]="jsonEditorContent"
          (ngModelChange)="onJsonChange()"
          rows="14"
          spellcheck="false"
          class="glass-input w-full px-4 py-3 rounded-lg text-sm font-mono resize-none"
          [class.border-red-500]="jsonError"
          placeholder="JSON de l'estimation..."
        ></textarea>
        <p *ngIf="jsonError" class="text-xs text-red-400">{{ jsonError }}</p>
        <p class="text-xs text-glass-muted">
          Modifiez directement le JSON pour mettre √† jour l'estimation.
        </p>
      </div>
    </div>

    <!-- Bouton Supprimer -->
    <div class="pt-6 border-t glass-divider">
      <button
        (click)="onDelete()"
        class="w-full px-4 py-2.5 text-red-400 hover:text-red-300 text-sm rounded-lg transition-colors flex items-center justify-center gap-2"
        title="Supprimer cette estimation"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Supprimer cette estimation
      </button>
    </div>
  </div>
</div>
