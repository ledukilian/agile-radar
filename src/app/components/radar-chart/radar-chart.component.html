<div #exportContainer class="glass-card rounded-2xl p-4 lg:p-6 flex flex-col">
  <div *ngIf="estimation" class="mb-3 lg:mb-4 pb-3 lg:pb-4 border-b glass-divider shrink-0">
    <div class="flex items-center gap-2 lg:gap-3">
      <span 
        class="w-8 lg:w-10 px-1.5 lg:px-2 py-0.5 lg:py-1 text-xs lg:text-sm font-bold rounded shrink-0 text-center"
        [ngClass]="[getTShirtSize().bgColor, getTShirtSize().textColor]"
      >
        {{ getTShirtSize().size }}
      </span>
      <h2 class="text-base lg:text-xl font-bold text-glass-primary truncate flex-1 min-w-0">{{ estimation.name }}</h2>
      <span 
        class="px-1.5 lg:px-2 py-0.5 lg:py-1 text-xs font-bold rounded shrink-0 whitespace-nowrap"
        [ngClass]="[getTShirtSize().bgColor, getTShirtSize().textColor]"
      >
        {{ getComplexityPointsCeil() }} pts
      </span>
    </div>
    <p *ngIf="estimation.description" class="mt-2 text-[11px] lg:text-xs text-glass-muted">{{ estimation.description }}</p>
  </div>

  <!-- D√©tail des 5 dimensions CURSE - Compact -->
  <div *ngIf="estimation" class="grid grid-cols-5 gap-1 lg:gap-1.5 mb-2 shrink-0">
    <!-- Complexity -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-yellow-500 text-white text-[10px] font-bold shrink-0">C</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('complexity'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('complexity') ? 'bg-yellow-500' : 'bg-gray-400'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.complexity }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Complexit√©</span>
      </div>
    </div>

    <!-- Uncertainty -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-purple-500 text-white text-[10px] font-bold shrink-0">U</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('uncertainty'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('uncertainty') ? 'bg-purple-500' : 'bg-gray-400'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.uncertainty }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Incertitude</span>
      </div>
    </div>

    <!-- Risk -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-red-500 text-white text-[10px] font-bold shrink-0">R</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('risk'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('risk') ? 'bg-red-500' : 'bg-gray-400'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.risk }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Risque</span>
      </div>
    </div>

    <!-- Size -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-green-500 text-white text-[10px] font-bold shrink-0">S</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('size'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('size') ? 'bg-green-500' : 'bg-gray-400'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.size }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Taille</span>
      </div>
    </div>

    <!-- Effort -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-blue-500 text-white text-[10px] font-bold shrink-0">E</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('effort'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('effort') ? 'bg-blue-500' : 'bg-gray-400'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.effort }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Effort</span>
      </div>
    </div>
  </div>

  <div class="relative flex items-center justify-center" style="height: 400px;">
    <canvas #chartCanvas></canvas>
  </div>
  <!-- Auteur sous le graphique -->
  <p *ngIf="estimation?.author" class="text-[11px] lg:text-xs text-glass-muted text-right mt-2">
    <span class="opacity-70">Estimation par</span> {{ estimation?.author }}
  </p>
  <!-- R√©sum√© global compact -->
  <div *ngIf="estimation" class="mt-2 shrink-0">
    <div class="flex items-center justify-between gap-2 p-2 lg:p-3 rounded-lg glass-inner">
      <!-- T-shirt size actuel -->
      <div class="flex items-center gap-2">
        <span class="w-10 lg:w-12 text-lg lg:text-xl font-black py-1 rounded text-center" [ngClass]="[getTShirtSize().bgColor, getTShirtSize().textColor]">
          {{ getTShirtSize().size }}
        </span>
        <div class="flex flex-col">
          <span class="text-sm lg:text-base font-bold" [ngClass]="getTShirtSize().textColor">{{ getComplexityPointsCeil() }} pts</span>
          <span class="text-[9px] lg:text-[10px] text-glass-muted">{{ getTShirtSize().min }}-{{ getTShirtSize().max }} pts</span>
        </div>
      </div>
      <!-- √âchelle T-shirt sizes -->
      <div class="flex items-center gap-1 lg:gap-1.5">
        <ng-container *ngFor="let tshirt of tShirtSizes">
          <div class="w-7 lg:w-9 py-1 rounded text-center transition-all text-[10px] lg:text-xs"
               [ngClass]="getTShirtSize().size === tshirt.size 
                 ? [tshirt.bgColor, tshirt.textColor, 'font-bold', 'scale-110'] 
                 : 'glass-inner text-glass-muted opacity-60'">
            {{ tshirt.size }}
          </div>
        </ng-container>
      </div>
    </div>
    <p class="mt-1.5 text-[10px] lg:text-[11px] text-glass-muted text-center hidden sm:block">üí° {{ getOverallDescription() }}</p>
  </div>

  <div *ngIf="!estimation" class="text-center text-glass-muted py-8">
    Aucune estimation s√©lectionn√©e. Utilisez le formulaire √† droite pour cr√©er ou modifier une estimation et voir le diagramme radar se mettre √† jour en temps r√©el.
  </div>
</div>

<!-- Boutons d'export -->
<div *ngIf="estimation" class="flex items-center justify-center gap-2 mt-3">
  <button 
    (click)="exportAsJpg()"
    [disabled]="isExporting"
    class="flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg glass-inner hover:bg-white/10 text-glass-secondary hover:text-glass-primary transition-all disabled:opacity-50 disabled:cursor-not-allowed"
  >
    <svg *ngIf="!isExporting" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
    </svg>
    <svg *ngIf="isExporting" class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    Exporter JPG
  </button>
  
  <button 
    (click)="copyToClipboard()"
    [disabled]="isExporting"
    class="flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg glass-inner hover:bg-white/10 text-glass-secondary hover:text-glass-primary transition-all disabled:opacity-50 disabled:cursor-not-allowed"
    [ngClass]="{'bg-green-500/20': copySuccess, 'text-green-400': copySuccess}"
  >
    <svg *ngIf="!isExporting && !copySuccess" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
    </svg>
    <svg *ngIf="copySuccess" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
    </svg>
    <svg *ngIf="isExporting && !copySuccess" class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    {{ copySuccess ? 'Copi√© !' : 'Copier l\'image' }}
  </button>
</div>
