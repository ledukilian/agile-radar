<div class="glass-card rounded-2xl p-4 lg:p-6 h-full flex flex-col overflow-auto">
  <div *ngIf="estimation" class="flex items-center gap-2 lg:gap-3 mb-3 lg:mb-4 pb-3 lg:pb-4 border-b glass-divider shrink-0">
    <span 
      class="w-8 lg:w-10 px-1.5 lg:px-2 py-0.5 lg:py-1 text-xs lg:text-sm font-bold rounded shrink-0 text-center"
      [ngClass]="[getTShirtSize().bgColor, getTShirtSize().textColor]"
    >
      {{ getTShirtSize().size }}
    </span>
    <h2 class="text-base lg:text-xl font-bold text-glass-primary truncate flex-1 min-w-0">{{ estimation.name }}</h2>
    <span class="px-1.5 lg:px-2 py-0.5 lg:py-1 text-xs font-medium rounded glass-inner text-glass-secondary shrink-0">
      {{ getComplexityPointsCeil() }} pts
    </span>
  </div>
  <div class="relative flex items-center justify-center -my-4 lg:-my-10 shrink-0" style="height: min(400px, 50vh);">
    <canvas #chartCanvas></canvas>
  </div>
  <!-- R√©sum√© global compact -->
  <div *ngIf="estimation" class="mt-2 p-2 lg:p-3 rounded-lg glass-inner">
    <!-- √âchelle T-shirt sizes -->
    <div class="flex items-center justify-center gap-0.5 lg:gap-1 mb-2">
      <ng-container *ngFor="let tshirt of tShirtSizes">
        <div class="w-6 lg:w-8 px-1 lg:px-1.5 py-0.5 rounded text-center transition-all text-[9px] lg:text-[10px]"
             [ngClass]="getTShirtSize().size === tshirt.size 
               ? [tshirt.bgColor, tshirt.textColor, 'font-bold', 'ring-1', 'ring-offset-1'] 
               : 'glass-inner text-glass-muted'">
          {{ tshirt.size }}
        </div>
      </ng-container>
    </div>
    <div class="flex items-center gap-2 lg:gap-4">
      <div class="flex items-center gap-1 lg:gap-2">
        <span class="w-10 lg:w-14 text-lg lg:text-2xl font-black px-1.5 lg:px-2 py-0.5 rounded text-center" [ngClass]="[getTShirtSize().bgColor, getTShirtSize().textColor]">
          {{ getTShirtSize().size }}
        </span>
        <div class="text-[10px] lg:text-xs text-glass-muted hidden sm:block">{{ getTShirtSize().min }}-{{ getTShirtSize().max }} pts</div>
      </div>
      <div class="flex-1 min-w-0">
        <div class="h-1.5 lg:h-2 glass-inner rounded-full overflow-hidden">
          <div class="h-full transition-all duration-500 rounded-full"
               [ngClass]="getTShirtProgressClass()"
               [style.width.%]="getCurseAverage()">
          </div>
        </div>
      </div>
      <div class="text-right shrink-0">
        <span class="text-base lg:text-lg font-bold text-glass-primary">{{ getComplexityPointsCeil() }}</span>
        <span class="text-[10px] lg:text-xs text-glass-muted ml-0.5 lg:ml-1">pts</span>
      </div>
    </div>
    <p class="mt-2 text-[10px] lg:text-[11px] text-glass-muted hidden sm:block">üí° {{ getOverallDescription() }}</p>
  </div>

  <!-- D√©tail des 5 dimensions CURSE - Compact -->
  <div *ngIf="estimation" class="mt-2 grid grid-cols-5 gap-1 lg:gap-1.5">
    <!-- Complexity -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-yellow-500 text-white text-[10px] font-bold shrink-0">C</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('complexity'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('complexity') ? 'bg-yellow-500' : 'bg-white/10'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.complexity }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Complexit√©</span>
      </div>
    </div>

    <!-- Uncertainty -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-purple-500 text-white text-[10px] font-bold shrink-0">U</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('uncertainty'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('uncertainty') ? 'bg-purple-500' : 'bg-white/10'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.uncertainty }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Incertitude</span>
      </div>
    </div>

    <!-- Risk -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-red-500 text-white text-[10px] font-bold shrink-0">R</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('risk'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('risk') ? 'bg-red-500' : 'bg-white/10'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.risk }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Risque</span>
      </div>
    </div>

    <!-- Size -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-green-500 text-white text-[10px] font-bold shrink-0">S</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('size'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('size') ? 'bg-green-500' : 'bg-white/10'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.size }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Taille</span>
      </div>
    </div>

    <!-- Effort -->
    <div class="p-2 rounded-lg glass-inner">
      <div class="flex items-center gap-1">
        <span class="w-5 h-5 flex items-center justify-center rounded-full bg-blue-500 text-white text-[10px] font-bold shrink-0">E</span>
        <div class="flex gap-0.5">
          <ng-container *ngFor="let grad of getGraduations('effort'); let i = index">
            <div class="w-1.5 h-1.5 rounded-full"
                 [ngClass]="i <= getGraduationIndex('effort') ? 'bg-blue-500' : 'bg-white/10'"
                 [title]="grad.label">
            </div>
          </ng-container>
        </div>
      </div>
      <div class="text-center -my-1">
        <span class="text-xs font-semibold text-glass-primary">{{ estimation.effort }}</span>
      </div>
      <div class="text-center">
        <span class="text-[9px] text-glass-muted">Effort</span>
      </div>
    </div>
  </div>

  <div *ngIf="!estimation" class="text-center text-glass-muted py-8">
    Aucune estimation s√©lectionn√©e. Utilisez le formulaire √† droite pour cr√©er ou modifier une estimation et voir le diagramme radar se mettre √† jour en temps r√©el.
  </div>
</div>
