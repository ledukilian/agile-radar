<div class="h-screen app-background flex flex-col overflow-hidden" [class.light-mode]="!isDarkMode">

  <!-- Main Content -->
  <main class="w-full flex-1 flex flex-col overflow-hidden">
    <div class="px-3 sm:px-6 lg:px-8 2xl:px-12 py-4 flex flex-col flex-1 overflow-hidden max-w-[2200px] mx-auto w-full">
      <div class="flex justify-between items-center mb-3 lg:mb-6 shrink-0">
        <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-glass-primary">
          <span class="hidden sm:inline">ğŸœ Agile Radar</span>
          <span class="sm:hidden">ğŸœ Radar</span>
          <span class="text-xs sm:text-sm font-normal text-glass-muted ml-1">v{{ appVersion }}</span>
        </h1>
        
        <!-- Mobile tabs (visible only when estimation is selected) -->
        <div class="flex lg:hidden gap-1" *ngIf="selectedEstimation">
          <button 
            (click)="mobileTab = 'list'"
            [class.active-tab]="mobileTab === 'list'"
            class="mobile-tab px-3 py-1.5 text-xs font-medium rounded-lg transition-all"
          >
            Liste
          </button>
          <button 
            (click)="mobileTab = 'chart'"
            [class.active-tab]="mobileTab === 'chart'"
            class="mobile-tab px-3 py-1.5 text-xs font-medium rounded-lg transition-all"
          >
            Radar
          </button>
          <button 
            *ngIf="isEditing"
            (click)="mobileTab = 'form'"
            [class.active-tab]="mobileTab === 'form'"
            class="mobile-tab px-3 py-1.5 text-xs font-medium rounded-lg transition-all"
          >
            Ã‰dition
          </button>
        </div>
      </div>

      <!-- Desktop Layout (lg+) -->
      <div class="hidden lg:flex gap-4 xl:gap-6 2xl:gap-10 flex-1 overflow-hidden">
        <!-- Colonne 1 : Liste des estimations (largeur fixe adaptative) -->
        <div class="flex flex-col rounded-2xl overflow-hidden w-80 xl:w-96 2xl:w-[26rem] shrink-0">
          <app-estimation-list
            class="flex-1 flex flex-col overflow-hidden"
            [selectedId]="selectedEstimation?.id"
            (selectEstimation)="onSelectEstimation($event)"
            (newEstimationCreated)="onNewEstimationCreated($event)"
          ></app-estimation-list>
        </div>

        <!-- Colonnes 2 et 3 : Radar + Formulaire/Recommandations (toujours la mÃªme largeur) -->
        <ng-container *ngIf="selectedEstimation">
          <!-- Colonne 2 : Radar Chart -->
          <div class="flex flex-col rounded-2xl overflow-hidden flex-1 min-w-0">
            <app-radar-chart 
              [estimation]="selectedEstimation"
              [showEditButton]="!isEditing"
              [isEditing]="isEditing"
              (editEstimation)="onStartEditing()"
              (closeEdit)="onStopEditing()"
            ></app-radar-chart>
          </div>

          <!-- Colonne 3 : Formulaire de dÃ©tails -->
          <div class="flex flex-col rounded-2xl overflow-hidden flex-1 min-w-0">
            <app-estimation-form
              *ngIf="isEditing"
              class="h-full"
              [estimation]="selectedEstimation"
              [compact]="true"
              (estimationChanged)="onEstimationChanged($event)"
              (deleteEstimation)="onDeleteEstimation($event)"
              (closeForm)="onStopEditing()"
            ></app-estimation-form>
          </div>
        </ng-container>
      </div>

      <!-- Mobile/Tablet Layout (<lg) -->
      <div class="flex lg:hidden flex-1 overflow-hidden">
        <!-- Si aucune estimation sÃ©lectionnÃ©e, on affiche la liste -->
        <div class="flex flex-col flex-1 overflow-hidden" *ngIf="!selectedEstimation">
          <app-estimation-list
            class="flex-1 flex flex-col overflow-hidden"
            [selectedId]="undefined"
            (selectEstimation)="onSelectEstimation($event)"
            (newEstimationCreated)="onNewEstimationCreated($event)"
          ></app-estimation-list>
        </div>

        <!-- Si une estimation est sÃ©lectionnÃ©e, on affiche selon le tab actif -->
        <ng-container *ngIf="selectedEstimation">
          <!-- Tab Liste -->
          <div class="flex flex-col flex-1 overflow-hidden" *ngIf="mobileTab === 'list'">
            <app-estimation-list
              class="flex-1 flex flex-col overflow-hidden"
              [selectedId]="selectedEstimation?.id"
              (selectEstimation)="onSelectEstimation($event)"
              (newEstimationCreated)="onNewEstimationCreated($event)"
            ></app-estimation-list>
          </div>

          <!-- Tab Radar Chart -->
          <div class="flex flex-col flex-1 overflow-hidden" *ngIf="mobileTab === 'chart'">
            <app-radar-chart 
              [estimation]="selectedEstimation"
              [showEditButton]="true"
              [isEditing]="isEditing"
              (editEstimation)="onStartEditing()"
              (closeEdit)="onStopEditing()"
            ></app-radar-chart>
          </div>

          <!-- Tab Formulaire (seulement en mode Ã©dition) -->
          <div class="flex flex-col flex-1 overflow-hidden" *ngIf="mobileTab === 'form' && isEditing">
            <app-estimation-form
              [estimation]="selectedEstimation"
              [compact]="true"
              (estimationChanged)="onEstimationChanged($event)"
              (deleteEstimation)="onDeleteEstimation($event)"
              (closeForm)="onStopEditing()"
            ></app-estimation-form>
          </div>
        </ng-container>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="py-2 px-4 text-right text-gray-400 text-xs shrink-0 bg-transparent">
    <div>v{{ appVersion }} â€¢ <a href="https://github.com/ledukilian/agile-radar" target="_blank" rel="noopener noreferrer" class="hover:text-glass-secondary underline">GitHub</a></div>
    <div class="hidden sm:block">Made with â¤ï¸ by <a href="https://ledukilian.fr" target="_blank" rel="noopener noreferrer" class="hover:text-glass-secondary underline">Kilian LE DU</a></div>
  </footer>
</div>
